% Shared packages and styles
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{tikz}
\usetikzlibrary{shapes.geometric, arrows.meta, positioning, calc, shadows}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{listings}
\usepackage{float}
\usepackage{subcaption}
\usepackage{enumitem}
\setlist{nosep}
\usepackage{amsmath, amssymb}
\usepackage{algorithm}
\usepackage{algpseudocode}

% Listings
\lstset{basicstyle=\ttfamily\footnotesize, breaklines=true, frame=single, numbers=left, numberstyle=\tiny, tabsize=2, showstringspaces=false}

% TikZ styles and helpers
\tikzset{block/.style={rectangle,draw,fill=blue!8,text width=8em,align=center,rounded corners,minimum height=3.2em,drop shadow},
         smallblock/.style={rectangle,draw,fill=blue!8,align=center,rounded corners,minimum height=2.2em,inner sep=4pt},
         entity/.style={rectangle,draw,fill=cyan!6,rounded corners,align=left,minimum width=14em},
         actor/.style={draw,thick},
         boundary/.style={draw,rounded corners,thick,dashed,gray!70,inner sep=8pt},
         note/.style={draw,fill=red!5,rounded corners,align=left},
         part/.style={rectangle,draw,rounded corners,fill=gray!8,minimum height=1.2em,align=center,inner sep=6pt},
         lifeline/.style={densely dashed,gray!70},
         exec/.style={rectangle,draw,fill=gray!15,minimum width=2.2em,minimum height=0.6cm},
         arrow/.style={-{Stealth[length=2.6mm]},thick}}
\newcommand{\placeholder}[2]{\begin{tikzpicture}\fill[white](0,0)rectangle(#1,#2);\draw[gray!50](0,0)rectangle(#1,#2);\node[gray]at(#1/2,#2/2){Placeholder Image};\end{tikzpicture}}

% Default image path
\graphicspath{{img/}}

% Adjusting figure width to prevent cutoff
\usepackage{adjustbox}

% Make figures fill more space
\setlength{\floatsep}{8pt}
\setlength{\textfloatsep}{8pt}
\setlength{\intextsep}{8pt}

% Allow overfull boxes for diagrams
\setlength{\vfuzz}{2pt}
\setlength{\hfuzz}{2pt}
\hbadness=10000
\vbadness=10000

% Improve tikz figure rendering
\tikzset{every picture/.style={/tikz/line cap=round, /tikz/line join=round}}

% Allow figures to extend into margins
\usepackage{marginfix}

% More aggressive figure expansion macro
\newcommand{\widefigure}[1]{%
  \par\medskip%
  \noindent\makebox[\textwidth]{%
    #1%
  }%
  \par\medskip%
}

% Alternative: use minipage to center and allow overflow
\newcommand{\widediagram}[1]{%
  \noindent
  \begin{minipage}[c]{\textwidth}
    \centering
    #1
  \end{minipage}
}

% Scale figures for better fit
\newcommand{\scalediagram}[2]{%
  \scalebox{#1}{#2}
}
